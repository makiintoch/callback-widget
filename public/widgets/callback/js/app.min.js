!function(){widgetCallback=function(options){function extend(){for(var e=1;e<arguments.length;e++)for(var t in arguments[e])arguments[e].hasOwnProperty(t)&&(arguments[0][t]=arguments[e][t]);return arguments[0]}("undefined"==typeof options||null==options)&&(options={});var callbackSettings={options:extend({texts:{call:{text1:{title:"— Хотите,",body:"чтобы мы перезвонили Вам и ответили на ваши вопросы?"},text2:{title:"— Сейчас сотрудники,",body:"не в офисе. Но в выбранное время Вам перезвонят."}},email:{text1:{title:"— Приветствую вас!",body:"хотите мы напишем Вам письмо?"}},send:{text1:{title:"— Спасибо,",body:"мы обязательно с вами свяжемся!"},text2:{title:"— Извините,",body:"произошла ошибка, мы уже знаем о ней, и исправим ее в ближайшее время."}}},rotate:{time:4e3},color:"#1f86c2",schema:"gray",position:{hor:"right",ver:"bottom"},time:{mon:{start:"09:00",end:"19:00",status:!0},tue:{start:"09:00",end:"19:00",status:!0},wed:{start:"09:00",end:"19:00",status:!0},thu:{start:"09:00",end:"19:00",status:!0},fri:{start:"09:00",end:"19:00",status:!0},sat:{start:"09:00",end:"19:00",status:!0},sun:{start:"09:00",end:"19:00",status:!0}},scenarios:{first:{status:!1},second:{status:!1,time:"8"},third:{status:!1,time:"2"},fourth:{status:!1},fifth:{status:!1}},serverUtc:"3",sound:!1},options),getWindowHeight:function(){var e=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;return e},getDocumentHeightScrollTop:function(){var e=document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop;return e},formatText:function(e,t){return'<span class="title">'+e+'</span><span class="desc">'+t+'</span> <span class="wf-cursor">_</span>'}},callbackOrder={addOrder:function(params,item){var widget=document.getElementById("wf-widget"),widgetContent=widget.querySelector(".wf-widget-content"),phoneForm=widget.querySelector(".wf-text-phone form"),xhr=new XMLHttpRequest,body="";body="call"==params.type?"time="+encodeURIComponent(params.time)+"&phone="+encodeURIComponent(params.phone)+"&key="+callbackSettings.options.key+"&type=call&url="+encodeURIComponent(location.host):"email="+encodeURIComponent(params.email)+"&phone="+encodeURIComponent(params.phone)+"&message="+encodeURIComponent(params.message)+"&key="+callbackSettings.options.key+"&type=email&url="+encodeURIComponent(location.host),xhr.open("POST",callbackSettings.options.serverHost+"api/v1/orders",!0),xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded"),xhr.onreadystatechange=function(){if(4==xhr.readyState){if(200==xhr.status){if(callbackInit.animateText(item,callbackSettings.options.texts.send.text1.title,callbackSettings.options.texts.send.text1.body),yandexTarget.id&&yandexTarget.name){var funcName="yaCounter"+yandexTarget.id;eval(funcName).reachGoal(yandexTarget.name)}}else callbackInit.animateText(item,callbackSettings.options.texts.send.text2.title,callbackSettings.options.texts.send.text2.body),console.log(xhr.responseText);phoneForm.style.display="none",widgetContent.style.cursor="default"}},xhr.send(body)},sendForm:function(){function e(e){for(var a,e=t.querySelector(e),s=e.getElementsByClassName("required"),n=0;n<s.length;n++)s[n].value&&s[n].value!=s[n].defaultValue?s[n].className=s[n].className.replace(/\berror\b/,""):(s[n].className=s[n].className+" error",a=!0);return a?!1:!0}for(var t=document.getElementById("wf-widget"),a=t.querySelector(".wf-widget-content"),s=t.getElementsByClassName("required"),n=t.querySelector(".wf-text-phone form"),o=t.querySelector(".wf-text-subscribe form"),i=0;i<s.length;i++)s[i].onkeyup=function(e){this.value&&this.value!=this.defaultValue?this.className=this.className.replace(/\berror\b/,""):this.className=this.className+" error"};n.onsubmit=function(s){s.preventDefault();var n=t.querySelector(".wf-day .wf-day-active"),o=t.querySelector(".wf-time .wf-time-active"),i=t.querySelector('.wf-text-phone form input[name="phone"]'),l=t.querySelector(".wf-text-phone .wf-text-item"),r=e(".wf-text-phone form"),c=n.dataset.serverDay+" в "+o.dataset.serverTime;if(r){var d={time:c,phone:i.value,type:"call"};a.style.cursor="wait",callbackOrder.addOrder(d,l)}},o.onsubmit=function(s){s.preventDefault();var n=e(".wf-text-subscribe form"),o=t.querySelector('.wf-text-subscribe form input[name="email"]'),i=t.querySelector('.wf-text-subscribe form input[name="phone"]'),l=t.querySelector('.wf-text-subscribe form textarea[name="message"]'),r=t.querySelector(".wf-text-subscribe .wf-text-item");if(n){var c={email:o.value,phone:i.value,message:l.value,type:"email"};a.style.cursor="wait",callbackOrder.addOrder(c,r)}}}},callbackDate={settings:{weekday:["sun","mon","tue","wed","thu","fri","sat"],getNextDay:function(e){return e>6?e-7:e}},isTodayWorkDay:function(){var e=new Date,t=callbackDate.getWorkDayArray(),a=e.getDay();return t.indexOf(a)>-1?!0:!1},getWorkDayArray:function(){for(var e=new Array,t=callbackDate.settings.weekday,a=callbackSettings.options.time,s=new Date,n=callbackSettings.options.serverUtc,o=s.getTimezoneOffset()/60,i=parseFloat(n)+parseFloat(o),l=0;l<t.length;l++)if(a[t[l]].status)if(t[s.getDay()]==t[l]){var r=new Date,c=a[t[l]].end.split(":");r.setHours(c[0]),r.setMinutes(c[1]),r.setTime(r.getTime()-60*i*60*1e3),r>=s&&e.push(l)}else e.push(l);return e},getSortDayArray:function(){var e=new Date,t=callbackDate.getWorkDayArray(),a=callbackDate.settings.getNextDay,s=e.getDay(),n=new Array;t.indexOf(s)>-1&&n.push(s);for(var o=0;o<callbackDate.settings.weekday.length&&!(n.length>=4);o++){var i=a(s+o);t.indexOf(i)>-1&&!(n.indexOf(i)>-1)&&n.push(i)}return n},getListDay:function(){for(var e=new Date,t=e.getDay(),a=t+1>6?0:t+1,s=callbackDate.settings.weekday,n=callbackDate.getSortDayArray(),o=a+1>6?0:a+1,i=["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"],l='<div class="wf-day-show">',r="",c="",d=0;d<n.length;d++){var u=new Date,m=(u.getDay()>n[d]?n[d]+7:n[d])-u.getDay();if(u.setDate(u.getDate()+m),n.indexOf(u.getDay())>-1){var g=u.getDate()+" "+i[u.getMonth()];c=t==u.getDay()?"Сегодня":a==u.getDay()?"Завтра":o==u.getDay()?"Послезавтра":"",r+=0==d?'<span class="wf-day-active" data-day="'+s[u.getDay()]+'" data-server-day="'+u.getDate()+" "+i[u.getMonth()]+'">'+(c.length?c:g)+"</span>":"",l+='<span class="wf-day-item" data-day="'+s[u.getDay()]+'" data-server-day="'+u.getDate()+" "+i[u.getMonth()]+'">'+(c.length?c:g)+"</span>"}}return l+="</div>",l.length?r+l:!1},getListTime:function(){for(var e=document.getElementById("wf-widget"),t={},a=callbackDate.settings.weekday,s=callbackDate.getSortDayArray(),n=callbackSettings.options.time,o=e.getElementsByClassName("wf-day-active"),i=o[0].dataset,l=i.day,r="",c='<div class="wf-time-show"><ul>',d=new Date,u=callbackSettings.options.serverUtc,m=d.getTimezoneOffset()/60,g=parseFloat(u)+parseFloat(m),f=0;f<s.length&&!(f>=4);f++){var w=new Array,p=new Date,y=new Date;if(s[f]==d.getDay()){var h=n[a[s[f]]].start.split(":"),v=n[a[s[f]]].end.split(":");p.setHours(d.getHours()+1),p.setMinutes(h[1])}else{var h=n[a[s[f]]].start.split(":"),v=n[a[s[f]]].end.split(":");p.setHours(h[0]),p.setMinutes(h[1]),p.setTime(p.getTime()-60*g*60*1e3)}y.setHours(v[0]),y.setMinutes(v[1]),y.setTime(y.getTime()-60*g*60*1e3);for(var h=p;y>=h;h.setMinutes(h.getMinutes()+60))w.push(new Date(h));t[a[s[f]]]=w}for(var f=0;f<t[l].length;f++){var b=(t[l][f].getHours()<10?"0"+t[l][f].getHours():t[l][f].getHours())+":"+(t[l][f].getMinutes()<10?"0"+t[l][f].getMinutes():t[l][f].getMinutes());t[l][f].setTime(t[l][f].getTime()+60*g*60*1e3);var k=(t[l][f].getHours()<10?"0"+t[l][f].getHours():t[l][f].getHours())+":"+(t[l][f].getMinutes()<10?"0"+t[l][f].getMinutes():t[l][f].getMinutes());r+=0==f?'<span class="wf-time-active" data-server-time="'+k+'">'+b+"</span>":"",c+='<li class="wf-time-item" data-server-time="'+k+'">'+b+"</li>"}return c+="</ul></div>",r+c},showDate:function(e){var t=document.getElementById("wf-widget"),a=t.querySelector(".wf-day");t.querySelector(".wf-time");a.innerHTML=e;var s=t.querySelector(".wf-day .wf-day-active"),n=t.querySelector(".wf-day-show");s.onclick=function(e){var a=t.getElementsByClassName("wf-day-item");"block"==n.style.display?n.style.display="none":n.style.display="block";for(var o=0;o<a.length;o++)a[o].onclick=function(){s.dataset.day=this.dataset.day,s.dataset.serverDay=this.dataset.serverDay,s.innerText=this.innerText,n.style.display="none",callbackDate.showTime(callbackDate.getListTime())}}},showTime:function(e){var t=document.getElementById("wf-widget"),a=t.querySelector(".wf-time");a.innerHTML=e;var s=t.querySelector(".wf-time .wf-time-active"),n=t.querySelector(".wf-time .wf-time-show");s.onclick=function(e){var a=t.getElementsByClassName("wf-time-item");"block"==n.style.display?n.style.display="none":n.style.display="block";for(var o=0;o<a.length;o++)a[o].onclick=function(e){s.dataset.serverTime=this.dataset.serverTime,s.innerText=this.innerText,n.style.display="none"}}}},callbackInit={setWidgetHeight:function(){var e=document.getElementById("wf-widget");e.style.height=callbackSettings.getWindowHeight(),window.onresize=function(t){e.style.height=callbackSettings.getWindowHeight()}},setWidgetButtonPosition:function(){var e=document.getElementById("wf-widget"),t=callbackSettings.getWindowHeight(),a=callbackSettings.getDocumentHeightScrollTop(),s=e.getElementsByClassName("wf-widget-call"),n=e.querySelector(".wf-widget-content "),o=e.querySelector(".wf-body"),i=(e.querySelector(".wf-select-time-text"),e.querySelector(".wf-powered-by"));switch(callbackSettings.options.position.ver){case"top":var l=100+a+"px";break;case"center":var l=t-(t/2+45)+a+"px";break;case"bottom":var l=t-200+a+"px"}s[0].style.top=l,500>t?(o.style.marginTop="10%",n.style.overflowY="scroll",i.style.position="relative"):(o.style.marginTop=(t-o.clientHeight)/2-150+"px",n.style.overflowY="visible",i.style.position="absolute")},resizeWindow:function(){window.onresize=function(e){null!==t&&clearTimeout(t);var t=setTimeout(function(){callbackInit.setWidgetButtonPosition()},250)}},scrollDocument:function(){window.onscroll=function(e){null!==t&&clearTimeout(t);var t=setTimeout(function(){callbackInit.setWidgetButtonPosition()},100)}},rotateButtons:function(){function e(){var e=window.setInterval(function(){s.classList.contains("wf-rotate-icon")?(s.classList.remove("wf-rotate-icon"),n.classList.add("wf-rotate-icon")):(n.classList.remove("wf-rotate-icon"),s.classList.add("wf-rotate-icon"))},callbackSettings.options.rotate.time);return e}var t=document.getElementById("wf-widget"),a=t.querySelector(".wf-widget-call"),s=t.querySelector(".wf-widget-name-icon"),n=t.querySelector(".wf-widget-phone-icon"),o="";o=e(),a.onmouseover=function(e){window.clearInterval(o),a.classList.add("wf-widget-call-hover"),n.classList.contains("wf-rotate-icon")&&(n.classList.remove("wf-rotate-icon"),s.classList.add("wf-rotate-icon"))},a.onmouseout=function(t){o=e(),a.classList.remove("wf-widget-call-hover")}},showWidgetContentBlock:function(){document.getElementsByClassName("wf-widget-call")[0].onclick=function(e){var t=document.getElementById("wf-widget"),a=t.getElementsByClassName("wf-widget-content"),s=t.querySelectorAll(".wf-icons .wf-icon"),n=t.querySelector(".wf-icons .wf-active"),o=Array.prototype.indexOf.call(s,n);if(this.className=this.className+" wf-hide",a[0].style[callbackSettings.options.position.hor]=0,o?callbackInit.animateText(a[0].querySelector(".wf-text-subscribe .wf-text-item")):callbackInit.animateText(a[0].querySelector(".wf-text-phone .wf-text-item")),"true"==callbackSettings.options.sound){var i=document.getElementById("wf-open-one-audio");i.volume=.2,i.play()}}},hideWidgetContentBlock:function(){var e=document.getElementById("wf-widget"),t=e.getElementsByClassName("wf-widget-content"),a=e.querySelector(".wf-widget-call");document.getElementsByClassName("wf-close")[0].onclick=function(e){a.classList.remove("wf-hide"),t[0].style[callbackSettings.options.position.hor]="-375px"},document.getElementsByClassName("wf-arrow")[0].onclick=function(e){a.classList.remove("wf-hide"),t[0].style[callbackSettings.options.position.hor]="-375px"}},changeTab:function(){for(var e=document.getElementById("wf-widget"),t=e.getElementsByClassName("wf-icon"),a=e.getElementsByClassName("wf-text"),s=0;s<t.length;s++)t[s].onclick=function(e){var s=this.classList.contains("wf-icon-phone");s===!0?(a[1].style.display="none",a[0].style.display="block",callbackInit.animateText(a[0].querySelector(".wf-text-item"))):(a[0].style.display="none",a[1].style.display="block",callbackInit.animateText(a[1].querySelector(".wf-text-item"))),t[0].className=t[0].className.replace(/\bwf-active\b/,""),t[1].className=t[1].className.replace(/\bwf-active\b/,""),this.className=this.className+" wf-active"}},animateText:function(e,t,a){function s(){e.querySelector(".title").textContent+=t[l],l++,l>=t.length&&(clearInterval(o),i=setInterval(n,15))}function n(){e.querySelector(".desc").textContent+=a[r],r++,r>=a.length&&clearInterval(i)}var o,i,l=0,r=0,t=t?t:e.querySelector(".title").innerText,a=a?a:e.querySelector(".desc").innerText;e.querySelector(".title").innerText=e.querySelector(".desc").innerText="",o=setInterval(s,20)},runScenarios:function(){function e(){var e=document.getElementById("wf-widget"),t=e.querySelector(".wf-widget-call"),a=e.getElementsByClassName("wf-widget-content");if("0px"!=a[0].style[callbackSettings.options.position.hor]&&(t.className=t.className+" wf-hide",a[0].style[callbackSettings.options.position.hor]=0,"true"==callbackSettings.options.sound)){var s=document.getElementById("wf-open-one-audio");s.volume=.2,s.play()}}function t(e){var t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0}var a=callbackSettings.options.scenarios;if(a.first.status&&(t("scenariosFirstStatus")||(e(),document.cookie="scenariosFirstStatus=true; path=/;")),a.second.status){if(!t("scenariosSecondStatus")){var s=parseFloat(a.second.time);setTimeout(e,60*s*1e3)}document.cookie="scenariosSecondStatus=true; path=/;"}if(a.third.status){var s=parseFloat(a.third.time);setInterval(e,60*s*1e3)}a.fourth.status&&(void 0==t("startPage")&&(document.cookie="startPage="+window.location.href+"; path=/;"),t("startPage")!=window.location.href&&(t("scenariosFourthStatus")||e(),document.cookie="scenariosFourthStatus=true; path=/;")),a.fifth.status&&window.addEventListener("scroll",function(a){window.innerHeight+window.scrollY>=document.body.offsetHeight&&(t("scenariosFifthStatus")||e(),document.cookie="scenariosFifthStatus=true; path=/;")},!1)},init:function(){var e="",t=document.getElementById("wf-widget"),a=t.getElementsByClassName("wf-widget-content"),s=t.getElementsByClassName("wf-widget-triangle"),n=t.getElementsByClassName("wf-arrow");e+='<div class="wf-widget-wrapper">',e+='<div class="wf-widget-call" style="top: 0; '+callbackSettings.options.position.hor+': 75px;">',e+='<div class="wf-widget-bg" style="background: '+callbackSettings.options.color+';">',e+='<span class="wf-widget-triangle"></span>',e+="</div>",e+='<span class="wf-widget-icon wf-widget-name-icon wf-rotate-icon"></span>',e+='<span class="wf-widget-icon wf-widget-phone-icon"></span>',e+="</div>",e+='<div class="wf-widget-content">',e+='<div class="wf-arrow"><span class="wf-arrow-top"></span><span class="wf-arrow-bottom"></span></div>',e+='<span class="wf-close"></span>',e+='<div class="wf-icons">',e+='<div class="wf-icon wf-icon-phone wf-active">',e+='<span class="wf-img"></span>',e+="<span>Звонок</span>",e+="</div>",e+='<div class="wf-icon wf-icon-subscribe">',e+='<span class="wf-img"></span>',e+="<span>Письмо</span>",e+="</div>",e+="</div>",e+='<div class="wf-body">',e+='<div class="wf-text wf-text-phone">',e+='<span class="wf-text-item"></span>',e+="<form>",e+='<div class="wf-select-time">',e+='<span class="wf-day"></span>',e+='<span class="wf-select-time-text">в</span>',e+='<span class="wf-time"></span>',e+="</div>",e+='<input class="required" type="text" name="phone" placeholder="Ваш телефон" value="">',e+='<input type="submit" value="Отправить">',e+="</form>",e+="</div>",e+='<div class="wf-text wf-text-subscribe" style="display: none;">',e+='<span class="wf-text-item"></span>',e+="<form>",e+='<textarea class="required" name="message" placeholder="Напишите вопрос"  value=""></textarea>',e+='<input class="required" type="text" name="email" placeholder="Ваш E-mail(для ответа)" value="">',e+='<input type="text" name="phone" placeholder="Ваш телефон(по желанию)">',e+='<input type="submit" value="Отправить">',e+="</form>",e+="</div>",e+="</div>",e+='<div class="wf-powered-by"><a href="http://calling-all.ru/">Установите виджет к себе на сайт</a></div>',e+="</div>",e+="</div>",t.innerHTML=e,"right"==callbackSettings.options.position.hor?(t.style.right=0,s[0].style.borderColor="transparent transparent transparent "+callbackSettings.options.color,s[0].style.left="83px",n[0].className=n[0].className+" wf-arrow-left"):(t.style.left=0,s[0].style.borderColor="transparent "+callbackSettings.options.color+" transparent transparent",s[0].style.right="83px",n[0].className=n[0].className+" wf-arrow-right"),a[0].style[callbackSettings.options.position.hor]="-375px",a[0].className=a[0].className+" wf-schema-"+callbackSettings.options.schema,callbackDate.isTodayWorkDay()?t.querySelector(".wf-text-phone .wf-text-item").innerHTML=callbackSettings.formatText(callbackSettings.options.texts.call.text1.title,callbackSettings.options.texts.call.text1.body):t.querySelector(".wf-text-phone .wf-text-item").innerHTML=callbackSettings.formatText(callbackSettings.options.texts.call.text2.title,callbackSettings.options.texts.call.text2.body),t.querySelector(".wf-text-subscribe .wf-text-item").innerHTML=callbackSettings.formatText(callbackSettings.options.texts.email.text1.title,callbackSettings.options.texts.email.text1.body);var o=callbackDate.getListDay();callbackDate.showDate(o);var i=callbackDate.getListTime();callbackDate.showTime(i),callbackInit.setWidgetButtonPosition(),callbackInit.resizeWindow(),callbackInit.scrollDocument(),callbackInit.showWidgetContentBlock(),callbackInit.hideWidgetContentBlock(),callbackInit.changeTab(),callbackInit.rotateButtons(),callbackInit.runScenarios(),callbackOrder.sendForm()}};return{on:callbackInit.init}};var widget=document.getElementById("wf-widget"),data=widget.dataset,color=data.color,schema=data.schema,pos=data.position,positionHor=pos.split("-")[0],positionVer=pos.split("-")[1],time=JSON.parse(data.time),timeGmt=data.gmt,scenarios=JSON.parse(data.scenarios),yandexTarget={id:data.yandexTargetId,name:data.yandexTargetName},googleTarget={id:data.googleTargetId,name:data.googleTargetName},sound=data.sound,key=data.key,wcb=widgetCallback({color:color,schema:schema,position:{hor:positionHor,ver:positionVer},time:time,serverUtc:timeGmt,scenarios:scenarios,yandexTarget:yandexTarget,googleTarget:googleTarget,sound:sound,key:key,serverHost:"http://calling-all.ru/"});wcb.on()}();