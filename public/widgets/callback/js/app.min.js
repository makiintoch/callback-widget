!function(){widgetCallback=function(e){function t(){for(var e=1;e<arguments.length;e++)for(var t in arguments[e])arguments[e].hasOwnProperty(t)&&(arguments[0][t]=arguments[e][t]);return arguments[0]}("undefined"==typeof e||null==e)&&(e={});var s={options:t({texts:{call:{text1:{title:"— Хотите,",body:"чтобы мы перезвонили Вам и ответили на ваши вопросы?"}},email:{text1:{title:"— Приветствую вас!",body:"хотите мы напишем Вам письмо?"}},send:{text1:{title:"— Спасибо,",body:"мы обязательно с вами свяжемся!"}}},rotate:{time:4e3},color:"#1f86c2",schema:"gray",position:{hor:"right",ver:"bottom"},time:{mon:{start:"09:00",end:"19:00",status:!0},tue:{start:"09:00",end:"19:00",status:!0},wed:{start:"09:00",end:"19:00",status:!0},thu:{start:"09:00",end:"19:00",status:!0},fri:{start:"09:00",end:"19:00",status:!0},sat:{start:"09:00",end:"19:00",status:!0},sun:{start:"09:00",end:"19:00",status:!0}},scenarios:{first:{status:!1},second:{status:!1,time:"8"},third:{status:!1,time:"2"},fourth:{status:!1},fifth:{status:!1}},serverUtc:"+3",sound:!1},e),getWindowHeight:function(){var e=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;return e},getDocumentHeightScrollTop:function(){var e=document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop;return e},showText:function(e){return e}},a={addOrder:function(e){var t=new XMLHttpRequest,a="";return a="call"==e.type?"time="+encodeURIComponent(e.time)+"&phone="+encodeURIComponent(e.phone)+"&key="+s.options.key+"&type=call&url="+encodeURIComponent(location.host):"email="+encodeURIComponent(e.email)+"&phone="+encodeURIComponent(e.phone)+"&message="+encodeURIComponent(e.message)+"&key="+s.options.key+"&type=email&url="+encodeURIComponent(location.host),t.open("POST",s.options.serverHost+"api/v1/orders",!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.send(a),200==t.status?{status:"success",data:t.responseText}:{status:"error",data:t.responseText}},sendForm:function(){function e(e){for(var s,e=t.querySelector(e),a=e.getElementsByClassName("required"),n=0;n<a.length;n++)a[n].value&&a[n].value!=a[n].defaultValue?a[n].className=a[n].className.replace(/\berror\b/,""):(a[n].className=a[n].className+" error",s=!0);return s?!1:!0}for(var t=document.getElementById("wf-widget"),s=t.getElementsByClassName("required"),n=t.querySelector(".wf-text-phone form"),o=t.querySelector(".wf-text-subscribe form"),i=0;i<s.length;i++)s[i].onkeyup=function(e){this.value&&this.value!=this.defaultValue?this.className=this.className.replace(/\berror\b/,""):this.className=this.className+" error"};n.onsubmit=function(s){s.preventDefault();var o=t.querySelector(".wf-day .wf-day-active"),i=t.querySelector(".wf-time .wf-time-active"),r=t.querySelector('.wf-text-phone form input[name="phone"]'),l=t.querySelector(".wf-text-phone .wf-text-item"),c=e(".wf-text-phone form"),d=o.dataset.serverDay+" в "+i.dataset.serverTime;if(c){var u={time:d,phone:r.value,type:"call"},m=a.addOrder(u);if("error"!=m.status){var f='<span>— Спасибо,</span>мы обязательно с вами свяжемся! <span class="wf-cursor">_</span>';l.innerHTML=f}else{var f='<span>— Извините,</span>произошла ошибка, мы уже знаем о ней, и исправим ее в ближайшее время. <span class="wf-cursor">_</span>';l.innerHTML=f,console.log(m.data)}n.style.display="none"}},o.onsubmit=function(s){s.preventDefault();var n=e(".wf-text-subscribe form"),i=t.querySelector('.wf-text-subscribe form input[name="email"]'),r=t.querySelector('.wf-text-subscribe form input[name="phone"]'),l=t.querySelector('.wf-text-subscribe form textarea[name="message"]'),c=t.querySelector(".wf-text-subscribe .wf-text-item");if(n){var d={email:i.value,phone:r.value,message:l.value,type:"email"},u=a.addOrder(d);if("error"!=u.status){var m='<span>— Спасибо,</span>мы обязательно с вами свяжемся! <span class="wf-cursor">_</span>';c.innerHTML=m}else{var m='<span>— Извините,</span>произошла ошибка, мы уже знаем о ней, и исправим ее в ближайшее время. <span class="wf-cursor">_</span>';c.innerHTML=m,console.log(u.data)}o.style.display="none"}}}},n={settings:{weekday:["sun","mon","tue","wed","thu","fri","sat"],getNextDay:function(e){return e>6?e-7:e}},getWorkDayArray:function(){for(var e=new Array,t=n.settings.weekday,a=s.options.time,o=new Date,i=s.options.serverUtc,r=o.getTimezoneOffset()/60,l=parseFloat(i)+parseFloat(r),c=0;c<t.length;c++)if(a[t[c]].status)if(t[o.getDay()]==t[c]){var d=new Date,u=a[t[c]].end.split(":");d.setHours(u[0]),d.setMinutes(u[1]),d.setTime(d.getTime()-60*l*60*1e3),d>=o&&e.push(c)}else e.push(c);return e},getSortDayArray:function(){var e=new Date,t=n.getWorkDayArray(),s=n.settings.getNextDay,a=e.getDay(),o=new Array;t.indexOf(a)>-1&&o.push(a);for(var i=0;i<n.settings.weekday.length&&!(o.length>=4);i++){var r=s(a+i);t.indexOf(r)>-1&&!(o.indexOf(r)>-1)&&o.push(r)}return o},getListDay:function(){for(var e=new Date,t=e.getDay(),s=t+1>6?0:t+1,a=n.settings.weekday,o=n.getSortDayArray(),i=s+1>6?0:s+1,r=["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"],l='<div class="wf-day-show">',c="",d="",u=0;u<o.length;u++){var m=new Date,f=(m.getDay()>o[u]?o[u]+7:o[u])-m.getDay();if(m.setDate(m.getDate()+f),o.indexOf(m.getDay())>-1){var w=m.getDate()+" "+r[m.getMonth()];d=t==m.getDay()?"Сегодня":s==m.getDay()?"Завтра":i==m.getDay()?"Послезавтра":"",c+=0==u?'<span class="wf-day-active" data-day="'+a[m.getDay()]+'" data-server-day="'+m.getDate()+" "+r[m.getMonth()]+'">'+(d.length?d:w)+"</span>":"",l+='<span class="wf-day-item" data-day="'+a[m.getDay()]+'" data-server-day="'+m.getDate()+" "+r[m.getMonth()]+'">'+(d.length?d:w)+"</span>"}}return l+="</div>",l.length?c+l:!1},getListTime:function(){for(var e=document.getElementById("wf-widget"),t={},a=n.settings.weekday,o=n.getSortDayArray(),i=s.options.time,r=e.getElementsByClassName("wf-day-active"),l=r[0].dataset,c=l.day,d="",u='<div class="wf-time-show"><ul>',m=new Date,f=s.options.serverUtc,w=m.getTimezoneOffset()/60,p=parseFloat(f)+parseFloat(w),g=0;g<o.length&&!(g>=4);g++){var y=new Array,v=new Date,h=new Date;if(o[g]==m.getDay()){var x=i[a[o[g]]].start.split(":"),b=i[a[o[g]]].end.split(":");v.setHours(m.getHours()+1),v.setMinutes(x[1])}else{var x=i[a[o[g]]].start.split(":"),b=i[a[o[g]]].end.split(":");v.setHours(x[0]),v.setMinutes(x[1]),v.setTime(v.getTime()-60*p*60*1e3)}h.setHours(b[0]),h.setMinutes(b[1]),h.setTime(h.getTime()-60*p*60*1e3);for(var x=v;h>=x;x.setMinutes(x.getMinutes()+60))y.push(new Date(x));t[a[o[g]]]=y}for(var g=0;g<t[c].length;g++){var T=(t[c][g].getHours()<10?"0"+t[c][g].getHours():t[c][g].getHours())+":"+(t[c][g].getMinutes()<10?"0"+t[c][g].getMinutes():t[c][g].getMinutes());t[c][g].setTime(t[c][g].getTime()+60*p*60*1e3);var S=(t[c][g].getHours()<10?"0"+t[c][g].getHours():t[c][g].getHours())+":"+(t[c][g].getMinutes()<10?"0"+t[c][g].getMinutes():t[c][g].getMinutes());d+=0==g?'<span class="wf-time-active" data-server-time="'+S+'">'+T+"</span>":"",u+='<li class="wf-time-item" data-server-time="'+S+'">'+T+"</li>"}return u+="</ul></div>",d+u},showDate:function(e){var t=document.getElementById("wf-widget"),s=t.querySelector(".wf-day");t.querySelector(".wf-time");s.innerHTML=e;var a=t.querySelector(".wf-day .wf-day-active"),o=t.querySelector(".wf-day-show");a.onclick=function(e){var s=t.getElementsByClassName("wf-day-item");"block"==o.style.display?o.style.display="none":o.style.display="block";for(var i=0;i<s.length;i++)s[i].onclick=function(){a.dataset.day=this.dataset.day,a.dataset.serverDay=this.dataset.serverDay,a.innerText=this.innerText,o.style.display="none",n.showTime(n.getListTime())}}},showTime:function(e){var t=document.getElementById("wf-widget"),s=t.querySelector(".wf-time");s.innerHTML=e;var a=t.querySelector(".wf-time .wf-time-active"),n=t.querySelector(".wf-time .wf-time-show");a.onclick=function(e){var s=t.getElementsByClassName("wf-time-item");"block"==n.style.display?n.style.display="none":n.style.display="block";for(var o=0;o<s.length;o++)s[o].onclick=function(e){a.dataset.serverTime=this.dataset.serverTime,a.innerText=this.innerText,n.style.display="none"}}}},o={setWidgetHeight:function(){var e=document.getElementById("wf-widget");e.style.height=s.getWindowHeight(),window.onresize=function(t){e.style.height=s.getWindowHeight()}},setWidgetButtonPosition:function(){var e=document.getElementById("wf-widget"),t=s.getWindowHeight(),a=s.getDocumentHeightScrollTop(),n=e.getElementsByClassName("wf-widget-call"),o=e.querySelector(".wf-widget-content "),i=e.querySelector(".wf-body"),r=(e.querySelector(".wf-select-time-text"),e.querySelector(".wf-powered-by"));switch(s.options.position.ver){case"top":var l=100+a+"px";break;case"center":var l=t-(t/2+45)+a+"px";break;case"bottom":var l=t-200+a+"px"}n[0].style.top=l,500>t?(i.style.marginTop="10%",o.style.overflowY="scroll",r.style.position="relative"):(i.style.marginTop=(t-i.clientHeight)/2-150+"px",o.style.overflowY="visible",r.style.position="absolute")},resizeWindow:function(){window.onresize=function(e){null!==t&&clearTimeout(t);var t=setTimeout(function(){o.setWidgetButtonPosition()},250)}},scrollDocument:function(){window.onscroll=function(e){null!==t&&clearTimeout(t);var t=setTimeout(function(){o.setWidgetButtonPosition()},100)}},rotateButtons:function(){function e(){var e=window.setInterval(function(){n.classList.contains("wf-rotate-icon")?(n.classList.remove("wf-rotate-icon"),o.classList.add("wf-rotate-icon")):(o.classList.remove("wf-rotate-icon"),n.classList.add("wf-rotate-icon"))},s.options.rotate.time);return e}var t=document.getElementById("wf-widget"),a=t.querySelector(".wf-widget-call"),n=t.querySelector(".wf-widget-name-icon"),o=t.querySelector(".wf-widget-phone-icon"),i="";i=e(),a.onmouseover=function(e){window.clearInterval(i),a.classList.add("wf-widget-call-hover"),o.classList.contains("wf-rotate-icon")&&(o.classList.remove("wf-rotate-icon"),n.classList.add("wf-rotate-icon"))},a.onmouseout=function(t){i=e(),a.classList.remove("wf-widget-call-hover")}},showWidgetContentBlock:function(){document.getElementsByClassName("wf-widget-call")[0].onclick=function(e){var t=document.getElementById("wf-widget"),a=t.getElementsByClassName("wf-widget-content");if(this.className=this.className+" wf-hide",a[0].style[s.options.position.hor]=0,"true"==s.options.sound){var n=document.getElementById("wf-open-one-audio");n.volume=.2,n.play()}}},hideWidgetContentBlock:function(){var e=document.getElementById("wf-widget"),t=e.getElementsByClassName("wf-widget-content"),a=e.querySelector(".wf-widget-call");document.getElementsByClassName("wf-close")[0].onclick=function(e){a.classList.remove("wf-hide"),t[0].style[s.options.position.hor]="-375px"},document.getElementsByClassName("wf-arrow")[0].onclick=function(e){a.classList.remove("wf-hide"),t[0].style[s.options.position.hor]="-375px"}},changeTab:function(){for(var e=document.getElementById("wf-widget"),t=e.getElementsByClassName("wf-icon"),s=e.getElementsByClassName("wf-text"),a=0;a<t.length;a++)t[a].onclick=function(e){var a=this.classList.contains("wf-icon-phone");a===!0?(s[1].style.display="none",s[0].style.display="block"):(s[0].style.display="none",s[1].style.display="block"),t[0].className=t[0].className.replace(/\bwf-active\b/,""),t[1].className=t[1].className.replace(/\bwf-active\b/,""),this.className=this.className+" wf-active"}},runScenarios:function(){function e(){var e=document.getElementById("wf-widget"),t=e.querySelector(".wf-widget-call"),a=e.getElementsByClassName("wf-widget-content");if("0px"!=a[0].style[s.options.position.hor]&&(t.className=t.className+" wf-hide",a[0].style[s.options.position.hor]=0,"true"==s.options.sound)){var n=document.getElementById("wf-open-one-audio");n.volume=.2,n.play()}}function t(e){var t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0}var a=s.options.scenarios;if(a.first.status&&(t("scenariosFirstStatus")||(e(),document.cookie="scenariosFirstStatus=true; path=/;")),a.second.status){if(!t("scenariosSecondStatus")){var n=parseFloat(a.second.time);setTimeout(e,60*n*1e3)}document.cookie="scenariosSecondStatus=true; path=/;"}if(a.third.status){var n=parseFloat(a.third.time);setInterval(e,60*n*1e3)}a.fourth.status&&(void 0==t("startPage")&&(document.cookie="startPage="+window.location.href+"; path=/;"),t("startPage")!=window.location.href&&(t("scenariosFourthStatus")||e(),document.cookie="scenariosFourthStatus=true; path=/;")),a.fifth.status&&window.addEventListener("scroll",function(s){window.innerHeight+window.scrollY>=document.body.offsetHeight&&(t("scenariosFifthStatus")||e(),document.cookie="scenariosFifthStatus=true; path=/;")},!1)},init:function(){var e="",t=document.getElementById("wf-widget"),i=t.getElementsByClassName("wf-widget-content"),r=t.getElementsByClassName("wf-widget-triangle"),l=t.getElementsByClassName("wf-arrow");e+='<div class="wf-widget-wrapper">',e+='<div class="wf-widget-call" style="top: 0; '+s.options.position.hor+': 75px;">',e+='<div class="wf-widget-bg" style="background: '+s.options.color+';">',e+='<span class="wf-widget-triangle"></span>',e+="</div>",e+='<span class="wf-widget-icon wf-widget-name-icon wf-rotate-icon"></span>',e+='<span class="wf-widget-icon wf-widget-phone-icon"></span>',e+="</div>",e+='<div class="wf-widget-content">',e+='<div class="wf-arrow"><span class="wf-arrow-top"></span><span class="wf-arrow-bottom"></span></div>',e+='<span class="wf-close"></span>',e+='<div class="wf-icons">',e+='<div class="wf-icon wf-icon-phone wf-active">',e+='<span class="wf-img"></span>',e+="<span>Звонок</span>",e+="</div>",e+='<div class="wf-icon wf-icon-subscribe">',e+='<span class="wf-img"></span>',e+="<span>Письмо</span>",e+="</div>",e+="</div>",e+='<div class="wf-body">',e+='<div class="wf-text wf-text-phone">',e+='<span class="wf-text-item"></span>',e+="<form>",e+='<div class="wf-select-time">',e+='<span class="wf-day"></span>',e+='<span class="wf-select-time-text">в</span>',e+='<span class="wf-time"></span>',e+="</div>",e+='<input class="required" type="text" name="phone" placeholder="Ваш телефон" value="">',e+='<input type="submit" value="Отправить">',e+="</form>",e+="</div>",e+='<div class="wf-text wf-text-subscribe" style="display: none;">',e+='<span class="wf-text-item"></span>',e+="<form>",e+='<textarea class="required" name="message" placeholder="Напишите вопрос"  value=""></textarea>',e+='<input class="required" type="text" name="email" placeholder="Ваш E-mail(для ответа)" value="">',e+='<input type="text" name="phone" placeholder="Ваш телефон(по желанию)">',e+='<input type="submit" value="Отправить">',e+="</form>",e+="</div>",e+="</div>",e+='<div class="wf-powered-by"><a href="http://calling-all.ru/">Установите виджет к себе на сайт</a></div>',e+="</div>",e+="</div>",t.innerHTML=e,"right"==s.options.position.hor?(t.style.right=0,r[0].style.borderColor="transparent transparent transparent "+s.options.color,r[0].style.left="83px",l[0].className=l[0].className+" wf-arrow-left"):(t.style.left=0,r[0].style.borderColor="transparent "+s.options.color+" transparent transparent",r[0].style.right="83px",l[0].className=l[0].className+" wf-arrow-right"),i[0].style[s.options.position.hor]="-375px",i[0].className=i[0].className+" wf-schema-"+s.options.schema,t.querySelector(".wf-text-phone .wf-text-item").innerHTML="<span>"+s.showText(s.options.texts.call.text1.title)+"</span> "+s.showText(s.options.texts.call.text1.body)+' <span class="wf-cursor">_</span>',t.querySelector(".wf-text-subscribe .wf-text-item").innerHTML="<span>"+s.options.texts.email.text1.title+"</span> "+s.options.texts.email.text1.body+' <span class="wf-cursor">_</span>';var c=n.getListDay();n.showDate(c);var d=n.getListTime();n.showTime(d),o.setWidgetButtonPosition(),o.resizeWindow(),o.scrollDocument(),o.showWidgetContentBlock(),o.hideWidgetContentBlock(),o.changeTab(),o.rotateButtons(),o.runScenarios(),a.sendForm()}};return{on:o.init}};var e=document.getElementById("wf-widget"),t=e.dataset,s=t.color,a=t.schema,n=t.position,o=n.split("-")[0],i=n.split("-")[1],r=JSON.parse(t.time),l=t.gmt,c=JSON.parse(t.scenarios),d=t.sound,u=t.key,m=widgetCallback({color:s,schema:a,position:{hor:o,ver:i},time:r,serverUtc:l,scenarios:c,sound:d,key:u,serverHost:"http://calling-all.ru/"});m.on()}();